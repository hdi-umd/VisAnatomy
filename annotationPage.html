<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
      const handler = d3.drag();
    </script>
    <link rel="shortcut icon" href="#" />
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.0.0/nouislider.min.css"
    />
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link rel="stylesheet" href="./annotationPage.css" />
    <title> </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css"
    />
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"
    ></script>
    <script type="text/javascript" src="js/html2canvas.min.js"></script>
    <script type="text/javascript" src="js/cleanup.js"></script>
    <script type="text/javascript" src="js/display.js"></script>
    <script type="text/javascript" src="js/extract.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <script type="text/javascript" src="js/preprocess-interaction.js"></script>
    <script type="text/javascript" src="js/grouping.js"></script>
    <script type="text/javascript" src="js/markAnnotation.js"></script>
    <script type="text/javascript" src="js/groupAnnotation.js"></script>
    <script type="text/javascript" src="js/layoutAnnotation.js"></script>
    <script type="text/javascript" src="js/encodingAnnotation.js"></script>
    <script type="text/javascript" src="js/constraintAnnotation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
    <script type="text/javascript">
      // has to be placed here to be able to called the KeyPress function in process.js
      document.onkeydown = KeyPress;
    </script>
    <script src="js/atlas.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-GLhlTQ8iRABdZLl6O5oZ8gneFt8B0ZxyZxcfJlF+OwzIbh0C2pZsSq8p0yZ6Jizo"
      crossorigin="anonymous"
    ></script>
  </head>
  <body ondrop="drop(event)" ondragover="allowDrop(event)">
    <div class="notification" id="alertBox">
      "notification info when saving"
    </div>
    <div>
      <ul id="demoList" class="demos" style="height: 90%"></ul>
    </div>

    <div id="preprocessUI" style="visibility: visible">
      <div id="annotationStages">
        <button
          id="prevButton"
          onclick="prevSection()"
          style="position: absolute; right: 80%; top: 8px"
        >
          Back
        </button>
        <div id="breadcrumb"></div>
        <button
          id="nextButton"
          onclick="nextSection()"
          style="position: absolute; left: 80%; top: 8px"
        >
          Next
        </button>

        <i
          class="far fa-save"
          id="saveButton"
          onclick="post()"
          style="position: absolute; top: 8px; right: calc(2%); font-size: 30px"
        ></i>

        <!-- <button
          id="saveButton"
          onclick="post()"
          style="position: absolute; top: 8px; right: calc(2%)"
        >
          Save
        </button> -->
      </div>
      <div class="mainbox" id="axisAndLegend">
        <div style="margin-left: 20px">
          <span style="margin-right: 30px; font-weight: bold"
            >Axis & Legend Detection Results</span
          >
          <span
            ><img
              id="questionMark"
              src="img/question mark.png"
              alt="Question Mark"
              style="width: 15px; height: 15px; cursor: pointer"
          /></span>
          <div
            id="chartTitle"
            class="chartTitle"
            style="
              height: 40px;
              position: absolute;
              top: -5px;
              right: 5px;
              width: 50%;
            "
            ondrop="drop(event)"
            ondragover="allowDrop(event)"
          ></div>
          <div class="pop-out-container" id="popOutContainer">
            <span class="close-button" id="closeButton">&times;</span>
            <div class="pop-out-content">
              Axes allow you to associate data points with specific values. Axis
              ticks help indicate the value of a chart's point. Axis titles
              provide you with context about these values. Axis labels describe
              portions of the axis.<br /><br />
              Legends help you to understand marks used in a visualization.
              Titles describe what part of the visualization the legend is
              describing. Keys are items that correspond to marks in the chart.
              Key labels describe what each key represents.<br /><br />
              Please refer to this
              <a
                href="https://docs.google.com/presentation/d/16inrHVY68xlDkUvm1-vOiDvc73Lzdrz4k1TeXARsj_g/edit#slide=id.g284e6c3512f_0_24"
                target="_blank"
                >link</a
              >
              for more information.
            </div>
          </div>
        </div>
        <div class="float-container" id="buttons" style="display: block">
          <!-- This is the main x axis div -->
          <div class="axisDiv" id="xAxisDiv">
            <!--This is the first part of the column-->
            <div class="axisMeta" id="xAxisMeta">
              <b>X axis</b>
              <input
                type="image"
                src="img/select-area.png"
                id="xArea"
                onclick="activateAreaSelect('x');"
                width="16px"
                height="16px"
                class="selectAreaBtn"
              /><br />
              <select
                class="fieldType"
                id="xFieldType"
                onchange="fieldTypeChanged('x')"
              >
                <option value="Null">none</option>
                <option value="string">categories</option>
                <option value="number">numbers</option>
                <option value="date">dates</option>
              </select>
            </div>

            <!--This is the second part of the column (title)-->

            <div
              class="axisTitle"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
              id="xTitle"
            ></div>

            <!--This is the third part of the column (the label)-->
            <div
              class="axisLabels"
              id="xLabels"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
            ></div>
            <input
              type="image"
              src="img/plus.png"
              id="addXAxis"
              onclick="addAxisLevel('x');"
              width="16px"
              height="16px"
              style="position: absolute; right: 7px"
              class="selectAreaBtn"
            />
          </div>

          <!-- This is the main y axis div -->
          <div class="axisDiv" id="yAxisDiv">
            <!-- This is the 1st column div -->

            <div class="axisMeta">
              <b>Y axis</b
              ><input
                type="image"
                src="img/select-area.png"
                id="yArea"
                onclick="activateAreaSelect('y');"
                width="16px"
                height="16px"
                class="selectAreaBtn"
              /><br />
              <select
                class="fieldType"
                id="yFieldType"
                onchange="fieldTypeChanged('y')"
              >
                <option value="Null">none</option>
                <option value="string">categories</option>
                <option value="number">numbers</option>
                <option value="date">dates</option>
              </select>
            </div>

            <!-- This is the 2nd column div -->

            <div
              class="axisTitle"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
              id="yTitle"
            ></div>

            <!-- This is the 3rd column div -->
            <div
              class="axisLabels"
              id="yLabels"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
            ></div>

            <input
              type="image"
              src="img/plus.png"
              id="addYAxis"
              onclick="addAxisLevel('y');"
              width="16px"
              height="16px"
              style="position: absolute; right: 7px"
              class="selectAreaBtn"
            />
          </div>

          <!-- This is the  main legend div -->

          <div class="axisDiv">
            <!-- This is the 1st column div -->

            <div class="axisMeta">
              <b>Legend</b
              ><input
                type="image"
                src="img/select-area.png"
                id="legendArea"
                onclick="activateAreaSelect('legend');"
                width="16px"
                height="16px"
                class="selectAreaBtn"
              /><br />
              <select class="fieldType" id="legendFieldType">
                <option value="Null">none</option>
                <option value="string">categories</option>
                <option value="number">numbers</option>
                <option value="date">dates</option>
              </select>
            </div>

            <!-- This is the 2nd column div-->
            <div
              class="axisTitle"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
              id="legendTitle"
            ></div>

            <!-- This is the 3rd column div-->
            <div
              class="axisLabels"
              id="legendLabels"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
            ></div>
          </div>
        </div>
      </div>
      <div id="container">
        <div
          id="rbox1"
          class="rbox1"
          style="
            position: absolute;
            top: 10px;
            left: 10px;
            display: block;
            border: #ccc 0px solid;
          "
        ></div>
        <div
          id="rbox2"
          class="rbox2"
          style="
            position: absolute;
            top: 10px;
            left: 10px;
            display: block;
            pointer-events: none;
            border: #ccc 0px solid;
          "
        >
          <svg
            id="overlay"
            height="100%"
            width="100%"
            preserveAspectRatio="xMinYMid"
          >
            <rect
              id="overlaySelection"
              style="
                visibility: hidden;
                stroke-width: 2px;
                stroke: blue;
                fill: none;
              "
            ></rect>
          </svg>
        </div>
        <div
          id="generalizedSelection"
          style="
            position: absolute;
            top: 20px;
            right: 10px;
            display: flex;
            flex-direction: column;
            width: 40%;
            height: calc(100% - 50px);
            border: #ccc 0px solid;
          "
        >
          <div style="width: 100%; padding: 5px">
            <div
              id="markRoles"
              style="
                flex-grow: 1;
                background-color: lightblue;
                margin-right: 5px;
                padding-top: 5px;
                padding-left: 10px;
                padding-bottom: 10px;
              "
            >
              <div style="display: flex; justify-content: space-between">
                <div style="flex-grow: 1; margin-right: 5px">
                  Assign a Mark Type
                  <select
                    class="fieldType"
                    id="markTypeSelection"
                    onchange="markAnnotationChanged('Type')"
                  >
                    <option value="none">Not Assigned</option>
                    <option value="Straight Line">Straight Line</option>
                    <option value="Polyline">Polyline</option>
                    <option value="Rectangle">Rectangle</option>
                    <option value="Circle">Circle</option>
                    <option value="Ellipse">Ellipse</option>
                    <option value="Ploygon">Ploygon</option>
                    <option value="Area">Area</option>
                    <option value="Image">Image</option>
                    <option value="Text">Text</option>
                  </select>
                </div>
                <div style="flex-grow: 1; margin-right: 5px">
                  Assign a Mark Role
                  <select
                    class="fieldType"
                    id="markRoleSelection"
                    onchange="markAnnotationChanged('Role')"
                  >
                    <option value="none">Not Assigned</option>
                    <option value="Chart Title">Chart Title</option>
                    <option value="Main Chart Mark">Main Chart Mark</option>
                    <option value="Horizontal Gridline">
                      Horizontal Gridline
                    </option>
                    <option value="Vertical Gridline">Vertical Gridline</option>
                    <option value="Annotation">Annotation</option>
                    <option value="X Axis Line">X Axis Line</option>
                    <option value="X Axis Tick">X Axis Tick</option>
                    <option value="Y Axis Line">Y Axis Line</option>
                    <option value="Y Axis Tick">Y Axis Tick</option>
                    <option value="Legend Mark">Legend Mark</option>
                    <option value="Legend Label">Legend Label</option>
                    <option value="Noise">Noise</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div style="display: flex; flex-grow: 1; width: 100%; height: 95%">
            <div
              style="
                padding: 5px;
                margin-bottom: 10px;
                vertical-align: top;
                width: 49%;
              "
            >
              <h4>
                All Marks (<span style="color: red" id="numberOfMarksSelected">
                  0
                </span>
                Selected)
              </h4>
              <div
                id="allMarks"
                style="
                  height: 85%;
                  overflow: scroll;
                  overflow: -moz-scrollbars-vertical;
                "
              ></div>
            </div>
            <div
              style="
                padding: 5px;
                margin-bottom: 10px;
                vertical-align: top;
                width: 49%;
              "
            >
              <h4>Batch Selections</h4>
              <div
                id="markSelections"
                style="
                  height: 85%;
                  overflow: scroll;
                  overflow: -moz-scrollbars-vertical;
                "
              ></div>
            </div>
          </div>
        </div>
        <div
          id="groupSelection"
          style="
            position: absolute;
            top: 20px;
            right: 10px;
            width: 40%;
            height: calc(100% - 50px);
            border: #ccc 0px solid;
          "
        >
          <div
            id="higherLevelGroups"
            style="
              position: absolute;
              top: 0;
              left: 0;
              overflow: scroll;
              overflow: -moz-scrollbars-vertical;
              height: 100%;
              width: 100%;
              border: 2px solid rgb(102, 105, 105);
              padding: 5px;
              margin-bottom: 10px;
              visibility: hidden;
            "
          >
            <h4>
              Select groups by clicking and then
              <button
                type="button"
                style="
                  padding: 1px 1px;
                  margin-left: 2.5px;
                  margin-right: 2.5px;
                  vertical-align: middle;
                "
                onclick="mergeGroups()"
              >
                merge</button
              >; if you want to redo the grouping, please click
              <button
                type="button"
                style="
                  padding: 1px 1px;
                  margin-left: 2.5px;
                  margin-right: 2.5px;
                  vertical-align: middle;
                "
                onclick="clearMergedGroups()"
              >
                clear</button
              >.
            </h4>
          </div>
          <div
            id="specifiedGroups"
            style="
              overflow: scroll;
              overflow: -moz-scrollbars-vertical;
              height: 200px;
              border: 2px solid rgb(102, 105, 105);
              padding: 5px;
              margin-bottom: 10px;
            "
          >
            <h4>
              Here display specified mark groups. Once all the main chart marks
              have been grouped, you can further
              <button
                type="button"
                style="
                  padding: 1px 1px;
                  margin-left: 2.5px;
                  margin-right: 2.5px;
                  vertical-align: middle;
                "
                onclick="go2HigherGrouping()"
              >
                specify higher-level groups
              </button>
              .
            </h4>
          </div>

          <div
            id="current-section"
            style="
              border: 2px solid rgb(102, 105, 105);
              padding: 5px;
              margin-bottom: 10px;
            "
          >
            <h4>
              Please select a group of main chart marks by drawing a rectangle
              using your mouse on the SVG visualization. Current selection
              contains the following marks:
            </h4>
            <div
              id="selectedGroup"
              style="
                height: 75px;
                overflow: scroll;
                overflow: -moz-scrollbars-vertical;
                margin: 0 0 5px 0;
              "
            ></div>
            <button
              class="btn"
              id="button4FormingGroups"
              style="margin-bottom: 5px"
              onclick="clickEvent4FormingGroupButton(event)"
            >
              selected marks form a group!
            </button>
          </div>

          <div
            id="possibleOtherGroupsContainer"
            style="
              visibility: hidden;
              border: 2px solid rgb(102, 105, 105);
              padding: 5px;
            "
          >
            <h4>Here display possible other valid mark groups.</h4>
            <p>
              Please hover over each label to see the highlight for the
              corresponding mark group, and decide if you would like to accept
              it or not by clicking the corresponding button shown below.
            </p>
            <div
              id="possibleOtherGroups"
              style="
                overflow: scroll;
                overflow: -moz-scrollbars-vertical;
                height: 200px;
              "
            ></div>
            <button class="btn" onclick="acceptInferredGroups()">Accept</button>
            <button class="btn" onclick="rejectInferredGroups()">Reject</button>
          </div>
        </div>
        <div
          id="LayoutAnnotation"
          style="
            position: absolute;
            top: 20px;
            right: 10px;
            width: 40%;
            height: calc(100% - 50px);
            border: #ccc 0px solid;
            visibility: hidden;
          "
        ></div>
      </div>
    </div>

    <script>
      const questionMark = document.getElementById("questionMark");
      const popOutContainer = document.getElementById("popOutContainer");
      const closeButton = document.getElementById("closeButton");

      questionMark.addEventListener("click", function () {
        //when ? is clicked
        popOutContainer.style.display = "block";
      });

      closeButton.addEventListener("click", function () {
        //when the cross mark is clicked
        popOutContainer.style.display = "none";
      });

      window.addEventListener("click", function (event) {
        //close window
        if (
          event.target !== questionMark &&
          event.target !== closeButton &&
          !popOutContainer.contains(event.target)
        ) {
          popOutContainer.style.display = "none";
        }
      });

      window.addEventListener("beforeunload", function (event) {
        event.returnValue = "Are you sure you want to leave?";
        return "Are you sure you want to leave?";
      });

      // Initialize the section title and breadcrumb navigation
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize breadcrumb navigation
        updateBreadcrumb();
      });

      var annotationLoaded = false;

      // breadcrumb ui functions
      const sectionTitles = [
        "Axis & Legend",
        "Marks",
        "Groups",
        "Layout",
        "Encodings",
        "Constraints",
      ];

      var currentSectionIndex = 0;

      function nextSection() {
        if (currentSectionIndex < sectionTitles.length - 1) {
          currentSectionIndex++;
        }
        updateBreadcrumb();
      }

      function prevSection() {
        if (currentSectionIndex > 0) {
          currentSectionIndex--;
        }
        updateBreadcrumb();
      }

      // Function to update the breadcrumb navigation
      function updateBreadcrumb() {
        const breadcrumbContainer = document.getElementById("breadcrumb");
        breadcrumbContainer.innerHTML = ""; // Clear previous breadcrumbs

        for (let i = 0; i < sectionTitles.length; i++) {
          const breadcrumbItem = document.createElement("span");
          breadcrumbItem.textContent = sectionTitles[i];
          breadcrumbItem.classList.add("breadcrumb-item");
          if (i === currentSectionIndex) {
            breadcrumbItem.classList.add("current-section");
          }
          breadcrumbContainer.appendChild(breadcrumbItem);

          if (i < sectionTitles.length - 1) {
            const separator = document.createElement("span");
            separator.textContent = " | ";
            breadcrumbContainer.appendChild(separator);
          }
        }
        arrangeAnnotationDivs(sectionTitles[currentSectionIndex]);
      }

      function arrangeAnnotationDivs(currentStage) {
        switch (currentStage) {
          case "Axis & Legend":
            allSVGElementID.forEach((rid) => {
              d3.select("#" + rid).style("opacity", "1");
            });
            // set the height of the container div
            d3.select("#container").style("height", "calc(100% - 300px)");

            referenceElements.forEach((rid) => {
              d3.select("#" + rid).style("opacity", "1");
            });
            allLeftNodes
              .map((node) => node.id)
              .forEach((r) => {
                if (r.length > 0) d3.select("#" + r).style("opacity", "1");
              });
            document.getElementById("axisAndLegend").style.visibility =
              "visible";
            document.getElementById("generalizedSelection").style.visibility =
              "hidden";
            document.getElementById("groupSelection").style.visibility =
              "hidden";
            document.getElementById(
              "possibleOtherGroupsContainer"
            ).style.visibility = "hidden";
            d3.select("#current-section").style("visibility", "hidden");
            d3.select("#specifiedGroups").style("visibility", "hidden");
            document.getElementById("higherLevelGroups").style.visibility =
              "hidden";
            d3.select("#vis")
              .on("mousedown", null)
              .on("mouseup", null)
              .on("mousemove", null);
            if (jsonArr?.texts) svgTextHighlight(jsonArr.texts);
            break;
          case "Marks":
            allSVGElementID.forEach((rid) => {
              d3.select("#" + rid).style("opacity", "1");
            });
            d3.select("#container").style("height", "calc(100% - 75px)");

            // remove all reference elements from contentMarks
            mainContentElements = groupSVGElementsByType();
            console.log(mainContentElements);

            // below for initilizing the mark annotation
            document.getElementById("numberOfMarksSelected").innerHTML = "0";
            initilizeMarkAnnotation();

            document.getElementById("axisAndLegend").style.visibility =
              "hidden";
            document.getElementById("generalizedSelection").style.visibility =
              "visible";
            document.getElementById("groupSelection").style.visibility =
              "hidden";
            d3.select("#current-section").style("visibility", "hidden");
            d3.select("#specifiedGroups").style("visibility", "hidden");
            document.getElementById(
              "possibleOtherGroupsContainer"
            ).style.visibility = "hidden";
            document.getElementById("higherLevelGroups").style.visibility =
              "hidden";
            d3.select("#vis")
              .on("mousedown", null)
              .on("mouseup", null)
              .on("mousemove", null);
            d3.select("#rbox1")
              .selectAll("text")
              .style("pointer-events", "none");

            break;
          case "Groups":
            d3.select("#LayoutAnnotation").style("visibility", "hidden");
            document.getElementById("axisAndLegend").style.visibility =
              "hidden";
            document.getElementById("generalizedSelection").style.visibility =
              "hidden";
            document.getElementById("groupSelection").style.visibility =
              "visible";
            d3.select("#current-section").style("visibility", "visible");
            d3.select("#specifiedGroups").style("visibility", "visible");
            document.getElementById("higherLevelGroups").style.visibility =
              "hidden";
            d3.select("#container").style("height", "calc(100% - 75px)");
            initilizeGroupAnnotation();
            break;
          case "Layout":
            d3.select("#LayoutAnnotation").style("visibility", "visible");
            initilizeLayoutAnnotation();
            document.getElementById("groupSelection").style.visibility =
              "hidden";
            d3.select("#current-section").style("visibility", "hidden");
            d3.select("#specifiedGroups").style("visibility", "hidden");
            document.getElementById("higherLevelGroups").style.visibility =
              "hidden";
            break;
          case "Encodings":
            d3.select("#LayoutAnnotation").style("visibility", "hidden");
            initilizeEncodingAnnotation();
            break;
          case "Constraints":
            initilizeConstraintAnnotation();
            break;
          default:
            document.getElementById("axisAndLegend").style.visibility =
              "hidden";
            document.getElementById("generalizedSelection").style.visibility =
              "hidden";
            break;
        }
      }

      var demoName, contentMarks, jsonArr;
      var areaSelection;
      const fileName = sessionStorage.getItem("fileName");
      var mainChartMarks;

      function loadDemo(demo) {
        // demo is the full name of a SVG file, e.g., "BarChart1.svg"
        sessionStorage.setItem("fileName", demo.split(".")[0]);
        tryLoadAnnotations(demo.split(".")[0]);

        fetch("./examples/" + demo)
          .then((resp) => {
            return resp.text();
          })
          .then((rawSVG) => {
            // TBD: we need to update the flattenSVG function to be consistent with groupSVGElementsByType(), to avoid the previous complex lead-node processing
            jsonArr = flattenSVG(rawSVG);

            currentSectionIndex = 0;
            updateBreadcrumb();

            demoName = demo;
            d3.select("#preprocessUI").style("visibility", "visible");

            // in display.js, adding id and class attributes to the svg file
            displaySVG(rawSVG);

            // in preprocess-interaction.js, attaching drag and drop event listeners to the svg text elements
            enableDragDrop(jsonArr.texts);

            if (!annotationLoaded) {
              // in extract.js, extracting from the svg file the legend mark and labels, and the x and y axis labels, ticks, and paths if any, and the grid lines if any
              // extract() calls displayAxis() and displayLegend() to display the extracted elements
              contentMarks = extract(jsonArr);
            }

            // in display.js, setting a proper view box for the svg file so that the svg file fits into the browser window
            setViewBox();

            // in preprocess-interaction.js, activating the area-selecting event so that one can also select the area of the legend, or x and y axis to annotate
            enableAreaSelection();
          });
      }

      document.addEventListener("keyup", function (e) {
        if (e.code == "Escape") deactivateAreaSelect();
      });

      $(document).ready(() => {
        fetch("./SVG_Names.json")
          .then((response) => response.json())
          .then((files) => {
            const fileGroups = {};
            const ulElement = document.getElementById("demoList");

            files.forEach((file) => {
              // Extract base name (e.g., "barChart" from "barChart1")
              const baseName = file.replace(/\d+\.svg$/, "");

              // Initialize the array for this baseName if it doesn't exist
              if (!fileGroups[baseName]) {
                fileGroups[baseName] = [];
              }

              // Add the file to the appropriate group
              fileGroups[baseName].push(file);
            });

            Object.keys(fileGroups).forEach((baseName) => {
              // Create the primary list item
              const li = document.createElement("li");
              li.textContent = baseName;
              ulElement.appendChild(li);

              // Create a sublist for each baseName
              const subUl = document.createElement("ul");
              subUl.classList.add("chartSublist");
              subUl.id = baseName + "List";
              subUl.style.display = baseName === "BarChart" ? "block" : "none"; // Initially hide the sublist
              li.appendChild(subUl);

              // Add event listener to toggle the sublist display
              li.addEventListener("click", (event) => {
                event.stopPropagation(); // Prevent the event from bubbling up
                subUl.style.display =
                  subUl.style.display === "none" ? "block" : "none";
              });

              // Create sublist items
              fileGroups[baseName].forEach((file) => {
                const subLi = document.createElement("li");
                subLi.classList.add("demoItem");
                subLi.id = file.split(".")[0];
                subLi.textContent = file.split(".")[0];

                // Add the same event listener as before
                subLi.addEventListener("click", () => {
                  event.stopPropagation();
                  initilizeVariables();
                  d3.selectAll(".axisLabels").selectAll("button").remove();
                  d3.selectAll(".axisTitle").selectAll("button").remove();
                  d3.selectAll(".chartTitle").selectAll("button").remove();
                  d3.select("#specifiedGroups").selectAll("div").remove();
                  d3.select("#selectedGroup").selectAll("button").remove();
                  d3.select("#possibleOtherGroups").selectAll("div").remove();
                  d3.select("#possibleOtherGroupsContainer").style(
                    "visibility",
                    "hidden"
                  );

                  d3.selectAll(".demoItem")
                    .style("color", "black")
                    .style("font-weight", "normal");

                  d3.select("#" + file.split(".")[0])
                    .style("color", "red")
                    .style("font-weight", "bold");

                  loadDemo(file);

                  document
                    .querySelectorAll(".chartSublist")
                    .forEach((el) => (el.style.display = "none"));
                  subUl.style.display = "block";
                });

                subUl.appendChild(subLi);
              });
            });

            d3.select("#BarChart1")
              .style("color", "red")
              .style("font-weight", "bold");
          });

        initilizeVariables();
        loadDemo("BarChart1.svg");
      });
    </script>
  </body>
</html>
