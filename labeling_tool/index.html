<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title> </title>
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <style>
      html {
        /* margin: 10px 10px 0px 10px; */
        padding: 0px;
        font-family: Arial;
      }
      body {
        font: normal 15px/20px Arial, serif;
        color: #333;
        margin: 0;
        padding: 0;
        background-color: #fff;
        min-height: 100%;
        height: 100%;
        overflow: hidden;
        overflow-y: auto;
      }

      div.upload {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        display: inline-block;
        height: 30px;
        padding: 3px 40px 3px 3px;
        position: relative;
        width: auto;
        min-width: 200px;
        margin-right: 20px;
      }

      div.upload:hover {
        opacity: 0.95;
      }

      div.upload input[type="file"] {
        display: input-block;
        width: 100%;
        height: 30px;
        opacity: 0;
        cursor: pointer;
        position: absolute;
        left: 0;
      }
      .uploadButton {
        background-color: #425f9c;
        border: none;
        border-radius: 3px;
        color: #fff;
        cursor: pointer;
        display: inline-block;
        height: 30px;
        margin-right: 15px;
        width: auto;
        padding: 0 20px;
        box-sizing: content-box;
      }

      .fileName {
        font-family: Arial;
        font-size: 14px;
      }

      .upload + .uploadButton {
        height: 38px;
      }

      #uploadData {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -60%);
      }
    </style>
  </head>
  <body>
    <div id="uploadData" style="padding: 0 30px 0 30px">
      <h2>Import and Annotate an SVG Chart</h2>
      <h3>
        Remark: if some style information is contained in the CSS file
        associated with the webpage in which the SVG is embedded in, try to add
        that information to the SVG file.
      </h3>
      <!-- solution from http://jsfiddle.net/umhva747/ -->
      <form action="annotationPage.html" id="uploadForm">
        <div style="margin-bottom: 15px;">
          <label for="chartType" style="display: block; margin-bottom: 5px; font-weight: bold;">Chart Type:</label>
          <select id="chartType" name="chartType" style="padding: 8px; border: 1px solid white; border-radius: 3px; font-size: 14px; min-width: 200px;">
            <option value="">Select chart type...</option>
            <option value="AreaChart">Area Chart</option>
            <option value="BarChart">Bar Chart</option>
            <option value="BarChartInRadialLayout">Bar Chart in Radial Layout</option>
            <option value="BoxAndWhisker">Box-and-whisker Plot</option>
            <option value="BubbleChart">Bubble Chart</option>
            <option value="BulletChart">Bullet Chart</option>
            <option value="BumpChart">Bump Chart</option>
            <option value="Calendar">Calendar</option>
            <option value="CandlestickChart">Candlestick Chart</option>
            <option value="CirclePacking">Circle Packing</option>
            <option value="ConnectedDotPlot">Connected Dot Plot</option>
            <option value="ConnectedScatterPlot">Connected Scatterplot</option>
            <option value="DensityPlot">Density Plot</option>
            <option value="DivergingStackedBarChart">Diverging Stacked Bar Chart</option>
            <option value="DonutChart">Donut Chart</option>
            <option value="DotPlot">Dot Plot</option>
            <option value="GanttChart">Gantt Chart</option>
            <option value="GeoHeatmap">Geo Heatmap</option>
            <option value="GroupedBarChart">Grouped Bar Chart</option>
            <option value="Heatmap">Heatmap</option>
            <option value="KagiChart">Kagi Chart</option>
            <option value="LineGraph">Line Graph</option>
            <option value="MarimekkoChart">Marimekko Chart</option>
            <option value="MatrixDiagram">Matrix Diagram</option>
            <option value="ParallelCoordinatesPlot">Parallel Coordinates Plot</option>
            <option value="PieChart">Pie Chart</option>
            <option value="PolarAreaChart">Polar Area Chart</option>
            <option value="RadarChart">Radar Chart</option>
            <option value="RadialBarChart">Radial Bar Chart</option>
            <option value="RangeChart">Range Chart</option>
            <option value="Scatterplot">Scatterplot</option>
            <option value="SpiralPlot">Spiral Plot</option>
            <option value="StackedAreaChart">Stacked Area Chart</option>
            <option value="StackedBarChart">Stacked Bar Chart</option>
            <option value="StreamGraph">Stream Graph</option>
            <option value="Treemap">Treemap</option>
            <option value="ViolinPlot">Violin Plot</option>
            <option value="WaffleChart">Waffle Chart</option>
            <option value="WaterfallChart">Waterfall Chart</option>
            <option value="WordCloud">Word Cloud</option>
          </select>
        </div>
        <div class="upload">
          <input type="button" class="uploadButton" value="Browse" />
          <input type="file" name="upload" accept="image/*" id="myFile" />
          <span class="fileName">Select file..</span>
        </div>
        <input type="submit" class="uploadButton" value="Import" />
      </form>
    </div>

    <script>
      document
        .getElementById("uploadForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const fileInput = document.getElementById("myFile");
          const file = fileInput.files[0];
          const filename = file.name;

          try {
            const response = await fetch(
              `http://localhost:5200/check_file_exists/${filename}`
            );
            const data = await response.json();

            // if (data.exists) {
            //     alert("File with the same name already exists in the examples folder. Please choose a different file or rename your file.");
            // } else {
            newSVG();

            // const reader = new FileReader();
            // reader.onload = async function (event) {
            //   const svgData = event.target.result;
            //   // Send the SVG data to the server
            //   const response = await fetch(`http://localhost:5200/save_file`, {
            //     method: "POST",
            //     headers: {
            //       "Content-Type": "text/plain",
            //       "X-Filename": filename, // Pass filename in header
            //     },
            //     body: svgData,
            //   });

            //   if (response.ok) {
            //     alert("File saved to examples folder.");
            //   } else {
            //     alert("Error saving file to examples folder.");
            //   }
            // };
            // reader.readAsText(file);

            event.target.submit();
            // }
          } catch (error) {
            console.error("Error:", error);
          }
        });

      $("input[type=file]").change(function (e) {
        $in = $(this);
        $in.next().html($in.val());
      });

      function newSVG() {
        let uploadedSVG = document.getElementById("myFile").files[0];
        let fileReader = new FileReader();
        fileReader.readAsText(uploadedSVG);

        fileReader.onload = function () {
          sessionStorage.setItem("svg", fileReader.result);
          sessionStorage.setItem("fileName", uploadedSVG.name);
        };
        document.getElementById("myFile").value = null;
      }

      $(document).ready(() => {
        sessionStorage.setItem("svg", "");
        sessionStorage.setItem("fileName", undefined);
      });
    </script>
  </body>
</html>
